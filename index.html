<!-- DESCRIPTION / NOTES / PLANNING:

-------------------------------------------------------------------------------------------------

CLIENT-SIDE LANDING PAGE

============================================================================================

Remote/Repo Name: https://github.com/tberey/node-js-api

Branch Name: https://github.com/tberey/node-js-api/tree/master

============================================================================================

-->

<!DOCTYPE html>
<html>
	<head>
		<!-- Set a Responsive scaled viewport, and assign Metadata. -->
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1">
			<title>Front-End</title>
		<meta name="author" content="Tom B">
		<meta name="description" content="">
        
        <!-- Set in-page CSS styling. -->
        <style type="text/css">
            body {
				display: flex;
			}

            button {
                margin-top: 30px;
                margin-left: 80%;
                margin-bottom: 6px;
            }

            input {
                width: 60%;
                margin-bottom: 6px;
                margin-left: 3px;
            }

            p, b {
                margin-left: 3px;
            }

            sup {
                float: right;
                margin-right: 4px;
            }

            .inputForm {
                flex: 1;
                width: 50%;
                margin-left: 2px;
                margin-right: 2px;
                background-color:rgb(106, 215, 223) ;
                border: 3px solid rgb(19, 0, 128);
            }

            .outputForm {
                flex: 1;
                width: 50%;
                margin-left: 2px;
                background-color:rgb(101, 245, 214) ;
                border: 3px solid rgb(19, 0, 128);
            }
		</style>
	</head>
    
    <!-- Begin Main Body. -->
	<body>
        <div class="inputForm">
            <b><u><h2>Create a New Note:</h2></u></b><hr>
            1) Title: *<br><input type="text" id="title-input"><br>
            2) Note: *<br><input type="text" id="note-input"><br>
            <button id="new-entry" type="button">Create Note</button><br><hr>
            <b><u><h2>Your Newest Note:</h2></u></b>
            <p id ="last-entry"></p>
        </div>
        
        <div class="outputForm">
            <input type="button" id="all-entry" value="Show All">
            <input type="button" id="all-del" value="DELETE ALL!!!">
            <b><u><h2>Your Notes:</h2></u></b><hr>
            <p id ="note"></p>
        </div>
        
        <!-- Begin Scripting. -->
        <script type="text/javascript">
            // Global Space

			// Wait for page to be ready.
			if (document.addEventListener) document.addEventListener("DOMContentLoaded", initialised, false);
            else window.onload = initialised;
            
            function initialised() {
                
                // Set event listener on button, to call anon function, which sends a XMLHttp GET request to add a new note to database.
				document.getElementById('new-entry').addEventListener('click',() => {
                    document.querySelector('#last-entry').innerHTML = ''; // Clear input side (newest entry), to prevent concatonation/repeated notes.

                    // Clear input fields after capturing their values for query string GET Req.
                    let title = document.getElementById('title-input').value;
                    document.getElementById('title-input').value = '';
                    let note = document.getElementById('note-input').value;
                    document.getElementById('note-input').value = '';
                    
                    var xhttp = new XMLHttpRequest(); // New request.
                    xhttp.onreadystatechange = function() { // On receipt of a state change from server, call anon func.
                        if (this.readyState == 4 && this.status == 200) {
                            
                            let lastNote = JSON.parse(xhttp.response)

                            document.querySelector('#last-entry').insertAdjacentHTML('beforeend', //Prepend each html block on each loop iteration. Data from object props.
                                `<span class="entries">
                                <p><b>Date & Time Created: </b>${lastNote.Date}, @ ${lastNote.Time}</p>
                                <p><b>TITLE: </b>${lastNote.Title}</p>
                                <p><b>BODY: </b>${lastNote.Note}</p>
                                </span><hr>`
                            );
                        }
                    }
                    xhttp.open("GET", 'http://localhost:8080/notes/new?title=' + title + '&note=' + note, true); // URI src & Request Method (GET). (Async is true).
                    xhttp.send(); // Send Request.
                });

                // Set event listener on button, to call anon function, which sends a XMLHttp GET request to read all notes in database.
                document.getElementById('all-entry').addEventListener('click',() => {
                    document.querySelector('#note').innerHTML = '';// Clear output, to prevent concatonation/repeated notes.
                    
                    var xhttp = new XMLHttpRequest(); // New request.
                    xhttp.onreadystatechange = function() { // On receipt of a state change from server, call anon func.
                        if (this.readyState == 4 && this.status == 200) { // Wait for healthy connection and state.
                            
                            // Convert string response body as JSON and return to assigned var. If nothing to convert, will return emtpy string (so not to loop).
                            let allNotes = (val) => {
                                (xhttp.response.indexOf('No Notes found') == -1) ? val = JSON.parse(xhttp.response) : val = '' ;
                                return val
                            }

                            if (!(allNotes().length)) document.querySelector('#note').innerHTML = xhttp.responseText; // If empty databse, return server message.

                            // Build returned data into DOM.
                            for (let i=0; i < allNotes().length; i++) { // Iterate (loop) through all notes returned from databse.
                                document.querySelector('#note').insertAdjacentHTML('beforeend', //Prepend each html block on each loop iteration. Data from object props.
                                    `<span class="entries">
                                    <p><b>Date & Time Created: </b>${allNotes()[i].Date}, @ ${allNotes()[i].Time}</p>
                                    <p><b>TITLE: </b>${allNotes()[i].Title}</p>
                                    <p><b>BODY: </b>${allNotes()[i].Note}</p>
                                    </span><hr>`
                                );
                            }
                        }
                    };
                    xhttp.open("GET", 'http://localhost:8080/notes/all', true); // URI/src & Request Method (GET). (Async is true).
                    xhttp.send(); // Send Request.
                });
                
                document.getElementById('all-del').addEventListener('click',() => {
                    document.querySelector('#note').innerHTML = 'DELETED ALL YOUR NOTES!';// Clear output, and show deleted message (Update to show server message).
                    document.querySelector('#last-entry').innerHTML = ''; // Clear input side.

                    var xhttp = new XMLHttpRequest(); // New request.
                    xhttp.open("GET", 'http://localhost:8080/notes/delAll', true); // URI src & Request Method (GET). (Async is true).
                    xhttp.send(); // Send Request.
                });
            }
		</script>
	</body>
</html>